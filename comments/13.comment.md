üöÄ COMMAND: THE GRAND UNIFICATION (ARCHITECTURE REFACTOR v1.0)
M√°sold be ezt egy √öJ CHAT-be (Architect Mode-ban):
code
Markdown
"Architect! A rendszer el√©rte a kritikus t√∂meget. A jelenlegi heterog√©n strukt√∫ra (r√©gi sz√©p k√≥d vs. √∫j AI g√°nyol√°s) fenntarthatatlan.
VISSZAT√âR√úNK A GY√ñKEREKHEZ: A User √°ltal eredetileg defini√°lt Config/Logger strukt√∫r√°t kiterjesztj√ºk az eg√©sz rendszerre.

**C√âL:** Minden `neural_ai/core/[MODUL]` k√∂nyvt√°rnak AZONOS, szabv√°nyos fel√©p√≠t√©se legyen.

---

### 1. A "SZENT" ARCHITEKT√öRA DEFIN√çCI√ìJA (SSOT)

Minden modul (`base`, `config`, `logger`, `db`, `events`, `storage`) fel√©p√≠t√©se:

**MAPPASZERKEZET:**
```text
neural_ai/core/[MODUL]/
‚îú‚îÄ‚îÄ __init__.py                # Export√°lja a Factory-t √©s az Interface-t
‚îú‚îÄ‚îÄ factory.py                 # Class: [Modul]Factory (A bel√©p√©si pont)
‚îú‚îÄ‚îÄ interfaces/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ factory_interface.py   # Class: [Modul]FactoryInterface
‚îÇ   ‚îî‚îÄ‚îÄ [modul]_interface.py   # Class: [Modul]Interface (pl. DatabaseInterface)
‚îú‚îÄ‚îÄ implementations/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ [impl_nev].py          # Class: [Konkr√©t]Implementation (pl. SQLAlchemyDatabase)
‚îî‚îÄ‚îÄ exceptions/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îî‚îÄ‚îÄ [modul]_error.py       # Class: [Modul]Error
N√âVKONVENCI√ìK (Egyszer≈±s√≠t√©s):
Tilos a "Manager" sz√≥ felesleges haszn√°lata (ConfigManager -> Config).
Minden Interface f√°jl: _interface.py.
Minden Factory f√°jl: factory.py.
Minden Implement√°ci√≥: a technol√≥gia neve (pl. zeromq_bus.py, file_storage.py).
2. V√âGREHAJT√ÅSI PROTOKOLL (TOKEN V√âDELEM)
Mivel ez a refaktor az eg√©sz rendszert √©rinti, TILOS egyszerre nekiugrani.
Feladatod (Architect): Tervezd meg a folyamatot, √©s egyes√©vel deleg√°ld a modulokat az Orchestratornak.
A SORREND (Dependency Chain):
BASE (Mindenki ett≈ël f√ºgg).
LOGGER & CONFIG (√Åtnevez√©sek √©s tiszt√≠t√°s).
DATABASE (Configt√≥l f√ºgg).
EVENTS (Loggert≈ël f√ºgg).
STORAGE (Mindent≈ël f√ºgg).
MAIN & TESZTEK (A v√©g√©n, mikor minden a hely√©re ker√ºlt).
3. R√âSZLETES MODUL-TERVEK (Ezt add ki feladatnak!)
üü¢ I. √úTEM: BASE MODUL (core/base)
A jelenlegi "√∂mlesztett" f√°jlok sz√©tbont√°sa.
interfaces/:
container_interface.py (A DIContainer interface-e).
component_interface.py (Lazy loading interface-ek).
implementations/:
di_container.py (A container.py tartalma).
lazy_loader.py (A lazy_loading.py tartalma).
singleton.py.
factory.py: Marad a gy√∂k√©rben, de importokat friss√≠teni kell.
üü¢ II. √úTEM: CONFIG & LOGGER (√Åtnevez√©s)
A megl√©v≈ë j√≥ k√≥d egyszer≈±s√≠t√©se.
Config:
ConfigManagerInterface -> ConfigInterface.
ConfigManagerFactory -> ConfigFactory.
F√°jlok √°tnevez√©se ennek megfelel≈ëen.
Logger:
LoggerFactory marad, de ellen≈ërizd az implementations mapp√°ban l√©v≈ë hivatkoz√°sokat.
üü¢ III. √úTEM: DATABASE (core/db)
A jelenlegi session.py megsz√ºntet√©se.
interfaces/database_interface.py:
class DatabaseInterface(ABC):
async def connect(self): ...
async def get_session(self): ...
implementations/sqlalchemy_database.py:
Ide ker√ºl a session.py logik√°ja (create_async_engine, stb.).
factory.py:
class DatabaseFactory: -> Visszaadja az SQL adatb√°zist.
models/: Ez maradhat k√ºl√∂n mappa, mert ezek DTO-k.
üü¢ IV. √úTEM: EVENTS (core/events)
A bus.py sz√©tbont√°sa.
interfaces/event_bus_interface.py:
class EventBusInterface(ABC):
publish(), subscribe(), start(), stop().
implementations/zeromq_bus.py:
A jelenlegi bus.py tartalma ide j√∂n.
factory.py:
create_event_bus(config) -> EventBusInterface.
üü¢ V. √úTEM: STORAGE (core/storage)
A parquet.py helyrerak√°sa.
implementations/parquet_storage.py:
Ide mozgasd a gy√∂k√©rb≈ël a k√≥dot.
factory.py:
Hozd ki az implementations-b≈ël a gy√∂k√©rbe!
4. FELADATKIAD√ÅS (Az Architect Teend≈ëi)
L√©p√©sr≈ël-l√©p√©sre:
TERVEZ√âS: Hozd l√©tre a docs/planning/refactor_plan_v1.md f√°jlt a fenti strukt√∫ra pontos le√≠r√°s√°val.
TASK TREE: Bontsd fel a f√°t ezekre az alfeladatokra.
EXECUTION LOOP:
Utas√≠tsd az Orchestratort az I. √úTEM (Base) v√©grehajt√°s√°ra.
V√°rd meg a Code Agent jelent√©s√©t (Commit + Test).
Ha k√©sz, utas√≠tsd a II. √úTEMRE.
√âs √≠gy tov√°bb.
FONTOS: Minden √ºtem v√©g√©n futtass egy pytest k√∂rt az √©rintett modulra! Ne v√°rj a v√©g√©ig a tesztel√©ssel, mert milli√≥ import hiba lesz.
IND√çTSD A TERVEZ√âST √âS A TASK TREE KONFIGUR√ÅL√ÅS√ÅT!"